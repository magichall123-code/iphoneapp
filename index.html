<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🎯 Quiz Mix – Stars & Dates</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .card{ @apply bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-slate-200; }
    .btn{ @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold shadow-sm border; }
    .btn-primary{ @apply bg-slate-900 text-white border-slate-900 hover:bg-slate-800; }
    .btn-ghost{ @apply bg-white hover:bg-slate-50 border-slate-200; }
    .chip{ @apply inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-700; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-200 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <header class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">🎯 Quiz Mix – Stars & Dates</h1>
        <p class="text-slate-600">Devine la date d'anniversaire d'une star… ou la star d'une date !</p>
      </div>
      <div class="hidden md:flex gap-2">
        <span class="chip">Mode mixte</span>
        <span class="chip">QCM</span>
        <span class="chip">Revue des réponses</span>
      </div>
    </header>

    <!-- Controls -->
    <section class="card p-4 md:p-6 mb-6">
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">Nombre de questions</label>
          <input id="qCount" type="number" min="5" max="100" value="20" class="w-full rounded-xl border-slate-300 focus:border-slate-900 focus:ring-slate-900" />
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Type de questions</label>
          <select id="qType" class="w-full rounded-xl border-slate-300 focus:border-slate-900 focus:ring-slate-900">
            <option value="mix">Mixte (aléatoire)</option>
            <option value="name2date">Star → Date</option>
            <option value="date2name">Date → Star</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Difficulté</label>
          <select id="difficulty" class="w-full rounded-xl border-slate-300 focus:border-slate-900 focus:ring-slate-900">
            <option value="normal">Normal (3 choix)</option>
            <option value="hard">Difficile (4 choix)</option>
          </select>
        </div>
      </div>
      <div class="mt-4 flex flex-wrap gap-3">
        <button id="startBtn" class="btn btn-primary">Lancer le quiz</button>
        <button id="reviewToggle" class="btn btn-ghost">Voir/masquer le corrigé</button>
        <button id="exportBtn" class="btn btn-ghost">Exporter en JSON</button>
      </div>
    </section>

    <!-- Import / custom dataset -->
    <details class="card p-4 md:p-6 mb-6">
      <summary class="cursor-pointer font-semibold">📥 Importer / éditer les données (optionnel)</summary>
      <p class="text-sm text-slate-600 mt-2">Format attendu : une entrée par ligne, <code>Nom;JJ;Mois</code> (ex. <em>Bob Marley;6;février</em>). Les mois peuvent être écrits en français (janvier… décembre) ou en chiffres (1-12).</p>
      <textarea id="dataInput" class="w-full mt-3 rounded-xl border-slate-300 min-h-[140px] font-mono text-sm" placeholder="Ex.\nBob Marley;6;février\nAlbert Einstein;14;mars\nScarlett Johansson;22;novembre"></textarea>
      <div class="mt-3 flex gap-3">
        <button id="appendData" class="btn btn-ghost">Ajouter au jeu</button>
        <button id="replaceData" class="btn btn-ghost">Remplacer le jeu</button>
      </div>
    </details>

    <!-- Quiz area -->
    <section id="quiz" class="hidden">
      <div class="card p-4 md:p-6 mb-4">
        <div class="flex items-center justify-between">
          <div class="text-sm text-slate-600">Question <span id="qIndex">1</span>/<span id="qTotal">10</span></div>
          <div class="text-sm text-slate-600">Score : <span id="score">0</span></div>
        </div>
        <div class="w-full h-2 bg-slate-200 rounded-full mt-3">
          <div id="progress" class="h-2 bg-slate-900 rounded-full" style="width:0%"></div>
        </div>
        <h2 id="questionText" class="text-xl md:text-2xl font-bold mt-4"></h2>
        <div id="choices" class="mt-4 grid gap-3"></div>
        <div class="mt-4 flex items-center gap-3">
          <button id="nextBtn" class="btn btn-primary">Question suivante</button>
          <span id="feedback" class="text-sm"></span>
        </div>
      </div>

      <div id="review" class="card p-4 md:p-6 hidden"></div>
    </section>

    <footer class="mt-10 text-center text-xs text-slate-500">
      Fait pour toi – données inspirées de ton PDF (anniversaires). Personnalise et exporte à volonté.
    </footer>
  </div>

<script>
// --- Dataset de base (extraits du PDF fourni) ---
// Format : { name:"…", day: 6, month: "février" }
const BASE = [
  {name:"Bob Marley",day:6,month:"février"},
  {name:"Elvis Presley",day:8,month:"janvier"},
  {name:"David Bowie",day:8,month:"janvier"},
  {name:"Albert Einstein",day:14,month:"mars"},
  {name:"Emma Watson",day:15,month:"avril"},
  {name:"Lionel Messi",day:24,month:"juin"},
  {name:"Britney Spears",day:2,month:"décembre"},
  {name:"Barack Obama",day:4,month:"août"},
  {name:"Céline Dion",day:30,month:"mars"},
  {name:"Taylor Swift",day:13,month:"décembre"},
  {name:"Victor Hugo",day:26,month:"février"},
  {name:"Jennifer Aniston",day:11,month:"février"},
  {name:"Eric Antoine",day:23,month:"septembre"},
  {name:"Cyril Hanouna",day:23,month:"septembre"},
  {name:"Patrick Fiori",day:23,month:"septembre"},
  {name:"Michael Jackson",day:29,month:"août"},
  {name:"Paul McCartney",day:18,month:"juin"},
  {name:"Scarlett Johansson",day:22,month:"novembre"},
  {name:"Ricky Martin",day:24,month:"décembre"},
  {name:"Mylène Farmer",day:12,month:"septembre"},
  {name:"Clint Eastwood",day:30,month:"mai"},
  {name:"Amy Winehouse",day:14,month:"septembre"},
  {name:"Sophie Marceau",day:17,month:"novembre"},
  {name:"Zinedine Zidane",day:23,month:"juin"},
  {name:"Miley Cyrus",day:23,month:"novembre"},
  {name:"Alyssa Milano",day:20,month:"décembre"},
  {name:"Vanessa Paradis",day:22,month:"décembre"},
  {name:"Brigitte Bardot",day:28,month:"septembre"},
  {name:"Jenifer",day:15,month:"novembre"},
  {name:"Bob Sinclar",day:10,month:"mai"},
  {name:"Stephen Curry",day:14,month:"mars"},
  {name:"Daniel Balavoine",day:5,month:"février"},
  {name:"David Copperfield",day:16,month:"septembre"},
  {name:"Elon Musk",day:28,month:"juin"},
  {name:"Daniel Radcliffe",day:23,month:"juillet"},
  {name:"Eric Clapton",day:30,month:"mars"},
  {name:"Shakira",day:2,month:"février"},
  {name:"Johnny Depp",day:9,month:"juin"},
  {name:"Al Pacino",day:25,month:"avril"},
  {name:"Bob Dylan",day:24,month:"mai"},
  {name:"Madonna",day:16,month:"août"},
  {name:"Lionel Richie",day:20,month:"juin"},
  {name:"Aamir",day:14,month:"mars"}, // placeholder if needed
  {name:"Anthony Hopkins",day:31,month:"décembre"},
  {name:"Val Kilmer",day:31,month:"décembre"},
  {name:"Jean Dujardin",day:19,month:"juin"},
  {name:"Hugh Grant",day:9,month:"septembre"},
  {name:"George Clooney",day:6,month:"mai"},
  {name:"Brad Pitt",day:18,month:"décembre"},
  {name:"Neymar",day:5,month:"février"},
  {name:"Cristiano Ronaldo",day:5,month:"février"},
  {name:"Michel Platini",day:21,month:"juin"},
  {name:"Barbra Streisand",day:24,month:"avril"},
  {name:"Keira Knightley",day:26,month:"mars"},
  {name:"Lady Gaga",day:28,month:"mars"}
];

const MONTHS_FR = ["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"];
function normalizeMonth(m){
  if(!m) return "";
  const s = String(m).trim().toLowerCase().replaceAll('.', '');
  const idx = MONTHS_FR.findIndex(x=>x===s);
  if(idx>-1) return MONTHS_FR[idx];
  const n = parseInt(s,10);
  if(!isNaN(n) && n>=1 && n<=12) return MONTHS_FR[n-1];
  return s;
}

let DATA = [...BASE];

// Parse user data
function parseLines(txt){
  const out=[];
  txt.split(/\n|\r/).forEach(line=>{
    const L=line.trim(); if(!L) return;
    const parts=L.split(';');
    if(parts.length<3) return;
    const [name, day, month] = parts;
    const d = parseInt(String(day).trim(),10);
    const m = normalizeMonth(month);
    if(!name.trim()||isNaN(d)||!m) return;
    out.push({name:name.trim(), day: d, month: m});
  });
  return out;
}

// UI ELTs
const qCountEl = document.getElementById('qCount');
const qTypeEl = document.getElementById('qType');
const diffEl = document.getElementById('difficulty');
const startBtn = document.getElementById('startBtn');
const reviewToggleBtn = document.getElementById('reviewToggle');
const exportBtn = document.getElementById('exportBtn');
const dataInput = document.getElementById('dataInput');
const appendDataBtn = document.getElementById('appendData');
const replaceDataBtn = document.getElementById('replaceData');

const quizSec = document.getElementById('quiz');
const qIndexEl = document.getElementById('qIndex');
const qTotalEl = document.getElementById('qTotal');
const scoreEl = document.getElementById('score');
const progressEl = document.getElementById('progress');
const questionText = document.getElementById('questionText');
const choicesEl = document.getElementById('choices');
const nextBtn = document.getElementById('nextBtn');
const feedbackEl = document.getElementById('feedback');
const reviewEl = document.getElementById('review');

appendDataBtn.onclick = ()=>{
  const parsed = parseLines(dataInput.value);
  if(parsed.length){ DATA = [...DATA, ...parsed]; alert(`${parsed.length} entrées ajoutées.`); }
  else alert('Aucune entrée valide trouvée.');
};

replaceDataBtn.onclick = ()=>{
  const parsed = parseLines(dataInput.value);
  if(parsed.length){ DATA = parsed; alert(`Jeu remplacé (${parsed.length} entrées).`); }
  else alert('Aucune entrée valide trouvée.');
};

exportBtn.onclick = ()=>{
  const blob = new Blob([JSON.stringify(DATA,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'stars-dates.json'; a.click();
  URL.revokeObjectURL(url);
};

// Quiz engine
let QUESTIONS = [], idx=0, score=0, review=[];

function randInt(n){ return Math.floor(Math.random()*n); }
function pick(arr, n){ const a=[...arr]; const out=[]; while(out.length<n && a.length){ out.push(a.splice(randInt(a.length),1)[0]); } return out; }
function formatDate(d,m){ return `${d} ${m}`; }
function uniqueBy(arr, key){ const seen=new Set(); return arr.filter(x=>{ const k=key(x); if(seen.has(k)) return false; seen.add(k); return true;}); }

function makeQuestion(entry, type, choiceCount){
  const correct = entry;
  if(type==='name2date'){
    const prompt = `Quelle est la date d\'anniversaire de ${correct.name} ?`;
    // candidates dates
    const others = pick(DATA.filter(x=>x!==correct), 20);
    const opts = uniqueBy([{d:correct.day,m:correct.month}, ...others.map(o=>({d:o.day,m:o.month}))], o=>`${o.d}-${o.m}`)
                  .slice(0, 10)
                  .map(o=>({label: formatDate(o.d,o.m), value:`${o.d}-${o.m}`}));
    const needed = choiceCount-1;
    const wrong = pick(opts.filter(o=>o.value !== `${correct.day}-${correct.month}`), needed);
    const choices = [...wrong, {label: formatDate(correct.day, correct.month), value: `${correct.day}-${correct.month}`, correct:true}];
    return { type, prompt, choices: shuffle(choices), answer:`${correct.day}-${correct.month}`, explain: `${correct.name} → ${formatDate(correct.day, correct.month)}` };
  } else if(type==='date2name'){
    const prompt = `Qui est né le ${formatDate(correct.day, correct.month)} ?`;
    const others = pick(DATA.filter(x=>x!==correct), 20);
    const opts = uniqueBy([{name:correct.name}, ...others.map(o=>({name:o.name}))], o=>o.name).slice(0, 10)
                  .map(o=>({label:o.name, value:o.name}));
    const needed = choiceCount-1;
    const wrong = pick(opts.filter(o=>o.value !== correct.name), needed);
    const choices = [...wrong, {label:correct.name, value:correct.name, correct:true}];
    return { type, prompt, choices: shuffle(choices), answer: correct.name, explain: `${formatDate(correct.day, correct.month)} → ${correct.name}` };
  }
}

function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }

function buildQuiz(){
  const total = Math.max(5, Math.min(parseInt(qCountEl.value||20,10), 100));
  const mode = qTypeEl.value;
  const hard = diffEl.value==='hard';
  const choiceCount = hard ? 4 : 3;
  const pool = pick(DATA, Math.min(DATA.length, total*3));
  QUESTIONS = [];
  pool.forEach(entry=>{
    const type = mode==='mix' ? (Math.random()<0.5?'name2date':'date2name') : mode;
    const q = makeQuestion(entry, type, choiceCount);
    if(q) QUESTIONS.push(q);
  });
  QUESTIONS = QUESTIONS.slice(0,total);
}

function renderQuestion(){
  const q = QUESTIONS[idx];
  qIndexEl.textContent = (idx+1);
  qTotalEl.textContent = QUESTIONS.length;
  questionText.textContent = q.prompt;
  feedbackEl.textContent = '';
  choicesEl.innerHTML = '';
  q.choices.forEach((c,i)=>{
    const btn = document.createElement('button');
    btn.className = 'btn btn-ghost w-full text-left';
    btn.innerHTML = `<span class="mr-2 font-semibold">${String.fromCharCode(97+i)})</span> ${c.label}`;
    btn.onclick = ()=>{
      if(btn.dataset.locked) return; // avoid double click
      btn.dataset.locked = '1';
      const correct = c.correct === true;
      if(correct){ score++; scoreEl.textContent = score; feedbackEl.textContent = '✅ Bonne réponse !'; btn.classList.add('ring-2','ring-green-500'); }
      else { feedbackEl.textContent = '❌ Mauvaise réponse'; btn.classList.add('ring-2','ring-red-500'); }
      // lock all, highlight correct
      Array.from(choicesEl.children).forEach(b=>{ b.disabled=true; if(b._isCorrect) b.classList.add('ring-2','ring-green-500'); });
      review.push({q:q.prompt, good:q.answer, explain:q.explain, picked:c.label, ok: correct});
    };
    btn._isCorrect = c.correct===true;
    choicesEl.appendChild(btn);
  });
  progressEl.style.width = `${(idx/QUESTIONS.length)*100}%`;
}

nextBtn.onclick = ()=>{
  if(idx < QUESTIONS.length-1){ idx++; renderQuestion(); }
  else {
    // end
    progressEl.style.width = '100%';
    questionText.textContent = `Terminé ! Score : ${score}/${QUESTIONS.length}`;
    choicesEl.innerHTML = '';
    nextBtn.disabled = true;
    renderReview();
  }
};

function renderReview(){
  if(!review.length){ reviewEl.classList.add('hidden'); return; }
  reviewEl.innerHTML = `<h3 class="text-xl font-bold mb-3">📋 Corrigé</h3>` +
    review.map((r,i)=>{
      const color = r.ok ? 'text-green-700' : 'text-red-700';
      return `<div class="mb-3"><div class="font-semibold ${color}">Q${i+1}. ${r.q}</div>
      <div class="text-sm">Ta réponse : ${r.picked || '<em>—</em>'}</div>
      <div class="text-sm">Bonne réponse : <span class="font-semibold">${r.explain}</span></div></div>`;
    }).join('');
}

reviewToggleBtn.onclick = ()=>{
  reviewEl.classList.toggle('hidden');
};

startBtn.onclick = ()=>{
  if(DATA.length < 10){ alert('Ajoute davantage d\'entrées pour un meilleur quiz.'); }
  idx = 0; score = 0; review = []; scoreEl.textContent = '0'; nextBtn.disabled=false;
  buildQuiz(); quizSec.classList.remove('hidden'); renderQuestion();
};
</script>
</body>
</html>
